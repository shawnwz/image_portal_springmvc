var CorbisUI=CorbisUI||{};CorbisUI.CTip=CorbisUI.CTip||{};(function(a,g){var c=[];var b=0;function f(i,j){if(a.isString(j)||a.isObject(j)){a(j).each(function(l,m){var k=a(m).data("ctip");if(k&&k!=i){k.hide();}});}else{if(j===true){a.each(c,function(k,l){if(l&&l!=i){l.hide();}});}}}function h(i){a.each(c,function(j,k){if(k==i){c.splice(j,1);}});}function d(i){c.push(i);return b++;}g.Tooltip=function(k,i,j){this._startTime=new Date().getTime();this._timer={};this._sizes={hover:{},target:{}};this._position={};this._targetNode=k;if(a.isString(k)){this._targetNode=a(a(k)[0]);}if(this._targetNode.data("ctip")){return;}this._id=d(this);this._content=i;this._options=a.extend(true,e(this._targetNode),j);this._status="instantiated";this._classes=this._options.style.classes;this._type=this._options.type;this._setupEventFunctions();this._buildContent();this._attachShowHideEvents();this._showIfReady();this._targetNode.data("ctip",this);};function e(i){return{content:{title:{text:"",button:" "},useSelector:false},style:{classes:{content:"",title:"",tooltip:"",footer:"",hiddenClass:"hdn"},type:{},showFooter:false},show:{when:{event:"click",target:i},ready:true,delay:100,solo:false,effect:{type:"fade",length:500}},hide:{when:{event:"unfocus",target:i},delay:100,effect:{type:"fade",length:500}},position:{corner:{target:"topLeft",tooltip:"topLeft"},adjust:{x:0,y:0},enableEdgeDetection:true,offsets:{width:0,height:0},enableDynamicUpdate:true,targetIsWindow:false},api:{}};}g.Tooltip.prototype.destroy=function(){clearTimeout(this._timer.hide);clearTimeout(this._timer.show);this._status="destroyed";this._targetNode.unbind(".ctip_"+this._id);a(document).unbind(".ctip_"+this._id);this._node.remove();this._targetNode.removeData("ctip");h(this);};g.Tooltip.prototype._buildContent=function(){this._onBeforeRender();var i="";if(this._classes.content){i=" "+this._classes.content;}var k="";if(this._classes.tooltip){k=" "+this._classes.tooltip+" "+this._classes.hiddenClass;}else{k=" "+this._classes.hiddenClass;}var j="";if(this._classes.footer){j=" "+this._classes.footer;}var n=(this._options.style.width!==undefined)?" width: "+this._options.style.width+"px;":"";var l=this._options.style.showFooter?'<div class="ctip-footer'+j+'"></div>':"";var m='<div class="ctip'+k+'" style="'+n+'">'+this._getTitle()+'<div class="ctip-content'+i+'">'+this._getContent()+"</div>"+l+"</div>";this._node=a(m);this._moveToContainer();this._status="created";this._onRender();};g.Tooltip.prototype._getContent=function(){var i=this._content;var l=this._options.content.useSelector;if(a.isObject(i)){i=i.html();this._content.remove();}if(l){var k=this._targetNode.find(i);if(k.length&&k[0]){var j=a(k[0]);i=j.html();}}return i;};g.Tooltip.prototype._getTitle=function(){var k=this._options.content.title.text;if(k){var i="";if(this._options.content.title.button){i='<a class="ctip-button"> </a>';}var j="";if(this._classes.title){j=" "+this._classes.title;}return'<div class="ctip-title'+j+'">'+i+k+"</div>";}return"";};g.Tooltip.prototype._moveToContainer=function(){var j=this._options.position.container;var i=this._targetNode.parent();if(j){i=j;if(a.isArray(i)){i=i[0];}i=a(i);}if(a.browser.msie&&a.browser.version=="6.0"){this._node.append(a('<iframe class="ctip_ie6_iframe"></iframe>'));}this._node.appendTo(i);};g.Tooltip.prototype._updatePosition=function(){if(!this._options.position.enableDynamicUpdate){return;}this._onBeforePositionUpdate();this._calculatePosition();this._node.css("left",this._position.x);this._node.css("top",this._position.y);this._onPositionUpdate();};g.Tooltip.prototype._calculatePosition=function(){this._getSizes();var m=this._options.position.corner.tooltip;var p=this._options.position.corner.target;var i=this._options.position.adjust.x;var j=this._options.position.adjust.y;if(!this._options.position.targetIsWindow){var o=this._targetNode.position();var k=this._calculateOffset(m,this._sizes.hover.width,this._sizes.hover.height,true);var l=this._calculateOffset(p,this._sizes.target.width,this._sizes.target.height,false);this._position.x=o.left+i+k.x+l.x;this._position.y=o.top+j+k.y+l.y;}else{var n=this._calculateOffset(m,a(window).width()-this._sizes.hover.width,a(window).height()-this._sizes.hover.height,false);this._position.x=i+n.x;this._position.y=j+n.y;}if(this._options.position.enableEdgeDetection){this._edgeDetection();}};g.Tooltip.prototype._edgeDetection=function(){var i=this._options.position.offsets;var j=a(window);this._position.x=this._getAdjustedPosition({axis:"x",position:this._position.x,size:this._sizes.hover.width+i.width,scroll:j.scrollLeft(),screenSize:j.width()});this._position.y=this._getAdjustedPosition({axis:"y",position:this._position.y,size:this._sizes.hover.height+i.height,scroll:j.scrollTop(),screenSize:j.height()});};g.Tooltip.prototype._getAdjustedPosition=function(i){var j=false;if(i.position<i.scroll){i.position=i.scroll;j=true;}else{if((i.position+i.size)>(i.scroll+i.screenSize)){i.position=(i.scroll+i.screenSize)-i.size;j=true;}}if(j&&a.isFunction(this._onEdgeAdjusted)){var k=this._onEdgeAdjusted(i);a.extend(i,k);}return i.position;};g.Tooltip.prototype._getSizes=function(){var j=this._node;var k=this._targetNode;var i=j.hasClass("hdn");j.show();if(i){j.removeClass("hdn");}this._sizes.hover.width=j.width();this._sizes.hover.height=j.height();j.hide();if(i){j.addClass("hdn");}this._sizes.target.width=k.width();this._sizes.target.height=k.height();};g.Tooltip.prototype._calculateOffset=function(l,m,i,j){var k=j?-1:1;switch(l){case"topLeft":return{x:0,y:0};case"topMiddle":return{x:Math.floor(m/2*k),y:0};case"topRight":return{x:m*k,y:0};case"leftMiddle":return{x:0,y:Math.floor(i/2*k)};case"center":return{x:m/2*k,y:Math.floor(i/2*k)};case"rightMiddle":return{x:m*k,y:Math.floor(i/2*k)};case"bottomLeft":return{x:0,y:i*k};case"bottomMiddle":return{x:Math.floor(m/2*k),y:i*k};case"bottomRight":return{x:m*k,y:i*k};default:return{x:0,y:0};}};g.Tooltip.prototype._showIfReady=function(){var k=this._options.show.when.event;if(this._options.show.ready){var l=new Date().getTime();var i=this._options.show.delay-(l-this._startTime);i=Math.max(i,10);var j=this;this._timer.show=setTimeout(function(){var m=null;if(k&&k=="mouseover"){m=j._targetNode.data("ctip_mouseStatus");j._targetNode.unbind("mouseout.ctip_ms");j._targetNode.unbind("mouseover.ctip_ms");}if(!m||m!="out"){j.show();}},i);}};g.Tooltip.prototype._attachShowHideEvents=function(){var m=this._options.show.when.event;var j=this._options.hide.when.event;var k=this._options.hide.fixed;var l=Math.max(this._options.show.delay,10);var i=Math.max(this._options.hide.delay,10);this._bindShowEvent(m,l,this);this._bindFixedEvents(m,i,k,this);this._bindHideEvent(j,i,this);this._bindCloseButtonEvent(this);};g.Tooltip.prototype._bindShowEvent=function(k,j,i){if(k){this._targetNode.bind(k+".ctip_"+this._id,function(l){clearTimeout(i._timer.hide);i._timer.show=setTimeout(function(){i.show();},j);l.stopPropagation();});}};g.Tooltip.prototype._bindFixedEvents=function(m,i,j,l){if(j){var k=(a.isString(j))?this._node.find(j):this._node;k.bind("mouseenter.ctip_"+this._id,function(n){clearTimeout(l._timer.hide);n.stopPropagation();});k.bind("mouseleave.ctip_"+this._id,function(n){clearTimeout(l._timer.show);l._timer.hide=setTimeout(function(){l.hide();},i);});}};g.Tooltip.prototype._bindHideEvent=function(k,j,l){if(k){if(k=="unfocus"){var i=true;a(document).bind("click.ctip_"+this._id,function(m){if(l._options.hide.when.event!="unfocus"){return;}if(!i&&(l._options.hide.unfocusIncludesTarget||a.inArray(m.target,l._targetNode)==-1)){clearTimeout(l._timer.show);l._timer.hide=setTimeout(function(){l.hide();},j);}i=false;});this._node.bind("click.ctip_"+this._id,function(m){if(l._options.hide.when.event!="unfocus"){return;}m.stopPropagation();});this._targetNode.bind("click.ctip_"+this._id,function(m){if(l._options.hide.unfocusIncludesTarget){clearTimeout(l._timer.show);l._timer.hide=setTimeout(function(){l.hide();},j);return;}});}else{this._targetNode.bind(k+".ctip_"+this._id,function(){clearTimeout(l._timer.show);l._timer.hide=setTimeout(function(){l.hide();},j);});}}};g.Tooltip.prototype._bindCloseButtonEvent=function(j){var i=this._node.find(".ctip-button");if(i.length){a(i[0]).bind("click.ctip_"+this._id,function(){j.hide();});}};g.Tooltip.prototype.show=function(i){var o=this._status;if(o!="showing"&&o!="shown"&&o!="destroyed"){var n=this._node;var k=this._options.show.effect.type;var j=this._options.show.effect.length;if(!this._onBeforeShow()){return;}this._updatePosition();this._status="showing";if(this._options.show.solo){f(this,this._options.show.solo);}n.stop(true,true);n.removeClass(this._classes.hiddenClass);var l=this;var m=function(){l._status="shown";l._onShow();if(a.isFunction(i)){i({source:this});}};this._runEffect(k,true,j,function(){switch(l._options.style.type){case"modal":if(0==a("#ctip-modal").length){a("body").append('<div id="ctip-modal"></div>');}break;case"popup":break;default:break;}if(a.isFunction(m)){m();}});}};g.Tooltip.prototype.hide=function(m,i){var p=this._status;if(p!="hidden"&&p!="hiding"&&p!="destroyed"){var o=this._node;var k=this._options.hide.effect.type;var j=this._options.hide.effect.length;if(!this._onBeforeHide()){return;}this._status="hiding";if(m){k="none";}o.stop(true,true);var n=this;var l=function(){o.addClass(n._classes.hiddenClass);o.css("display","");n._status="hidden";n._onHide();switch(n._options.style.type){case"modal":a("#ctip-modal").remove();break;case"popup":break;default:break;}if(a.isFunction(i)){i({source:this});}};this._runEffect(k,false,j,l);}};g.Tooltip.prototype._runEffect=function(k,l,j,i){if(a.isFunction(k)){return k(this._node,j,i);}switch(k){case"fade":if(l){this._node.fadeOut(0);this._node.fadeIn(j,i);}else{this._node.fadeOut(j,i);}break;case"slide":this._node[l?"slideDown":"slideUp"](j,i);break;case"grow":this._node[l?"show":"hide"](j,i);break;default:this._node[l?"show":"hide"]();if(a.isFunction(i)){i();}break;}};g.Tooltip.prototype._runEvent=function(j,i){if(a.isFunction(j)){return j(this,i);}return true;};g.Tooltip.prototype._setupEventFunctions=function(){var i=["Render","Show","Hide","PositionUpdate","EdgeAdjusted"];a.each(i,function(k,j){g.Tooltip.prototype["_onBefore"+j]=function(l){return g.Tooltip.prototype._runEvent(this._options.api["onBefore"+j],l);};g.Tooltip.prototype["_on"+j]=function(l){return g.Tooltip.prototype._runEvent(this._options.api["on"+j],l);};});};a.fn.ctip=function(i,j){new g.Tooltip(this,i,j);return this;};a.fn.ctipTrackMouseStatus=function(){var i=this;this.data("ctip_mouseStatus","none");this.bind("mouseleave.ctip_ms",function(){i.data("ctip_mouseStatus","out");});this.bind("mouseenter.ctip_ms",function(){i.data("ctip_mouseStatus","over");});return this;};})(jQuery,CorbisUI.CTip);