var CI=CI||{};CI.UI=CI.UI||{};CI.UI.Flyout=CI.UI.Flyout||{};CI.UI.Flyout.Categories=CI.UI.Flyout.Categories||{};CI.UI.Flyout.Categories.Hover=CI.UI.Flyout.Categories.Hover||{};var CorbisUtilities=CorbisUtilities||{};CorbisUtilities.StaticResourceManager=CorbisUtilities.StaticResourceManager||{};CI.UI.Header=CI.UI.Header||{};CI.UI.Header.VisualSearch=CI.UI.Header.VisualSearch||{};CI.UI.Flyout.Categories={AnyCategory:"任何类别",Creative:"创意类",Documentary:"纪实",Editorial:"编辑类（RM）",Entertainment:"娱乐",FineArt:"艺术作品",Historical:"历史",News:"时事",NewsArchive:"档案",Outline:"Outline",Picplan:"仅限 OnDemand",RightsManaged:"版权管理图片（RM）",RoyaltyFree:"免版税图片（RF）",ShowAdvancedSearch:"使用高级搜索 >",Sports:"体育",CategoryCount:"{0}个类别",AdvancedSearchPrefix:"要搜索某个摄影师的作品？"};CI.UI.Flyout.Categories.Hover={BlackWhite:"黑白",Creative:"可作商业用途、充满艺术美的图像",Documentary:"旅游、文化、大自然、科技、科学以及食物的图片",FineArt:"画作、雕塑以及插画",RightsManaged:"使用授权及费用根据每个方案使用图片的情况而定",RoyaltyFree:"支付一次性划一费用，图片可以在多个方案里无限次使用",Photography:"摄影",Illustration:"插画",Color:"彩色",ModelRelease:"只搜索包含肖像权同意书的图像",Entertainment:"过去20年的娱乐事件和名人偶像",NoPeople:"没有人物",Outline:"独家名人肖像",Picplan:"搜索结果仅包括您的 OnDemand 中供应的图片。",Historical:"20多年以前的事件、人物和文化",News:"从过去20年到今天的全球新闻报道",NewsArchive:"过去20年的新闻图片",Sports:"过去20年的体育事件和名人偶像",Editorial:"关于真实的事件、人物、地点和物件的版权管理图片"};CI.UI.Header.VisualSearch={ChooseFile:"Choose file",ErrorFormat:"Please select another file format.",ErrorKeyword:"Please enter valid keywords.",ErrorSize:"Please choose a smaller image. Maximum file size exceeded.",ErrorUrl:"Please enter a valid image URL.",HelpTitle:"How to upload and search with image",KeywordHelp:"Providing descriptive keywords will improve your search by returning visually similar results that are relevant to the subject matter you want.",KeywordInfo:'Describe your image with keywords to improve your search. <span class="notice">(required)</span>',KeywordTitle:"Why enter keywords?",MoreHelp:"See more about upload and search with image",NoFile:"No file chosen.",NoImage:"NO IMAGE",PasteInfo:"Paste your image URL address.",Title:"Upload and search with image",UploadHelp:"Select an image file that is less than 10MB. All file formats (.jpg, .png, .tiff, etc) are supported.",UploadTitle:"Upload an image",UrlHelp:"Right-click an image on the web and copy the image's URL (not the page's URL). Paste in the URL(Ctrl+V or Command+V) in the field.",UrlTitle:"Enter image URL"};(function(){this.AddCSS=this.AddCSS||function(b){var c=document.getElementsByTagName("head")[0];var a=document.createElement("style");a.type="text/css";a.media="screen";if(a.styleSheet){a.styleSheet.cssText=b;}else{a.appendChild(document.createTextNode(b));}c.appendChild(a);};}).apply(CorbisUtilities.StaticResourceManager);var soy=soy||{};(function(){var b=navigator.userAgent;var a=b.indexOf("Opera")==0;soy.IS_OPERA_=a;soy.IS_IE_=!a&&b.indexOf("MSIE")!=-1;soy.IS_WEBKIT_=!a&&b.indexOf("WebKit")!=-1;})();soy.StringBuilder=function(a,b){this.buffer_=soy.IS_IE_?[]:"";if(a!=null){this.append.apply(this,arguments);}};soy.StringBuilder.prototype.bufferLength_=0;soy.StringBuilder.prototype.append=function(a,c,d){if(soy.IS_IE_){if(c==null){this.buffer_[this.bufferLength_++]=a;}else{this.buffer_.push.apply(this.buffer_,arguments);this.bufferLength_=this.buffer_.length;}}else{this.buffer_+=a;if(c!=null){for(var b=1;b<arguments.length;b++){this.buffer_+=arguments[b];}}}return this;};soy.StringBuilder.prototype.clear=function(){if(soy.IS_IE_){this.buffer_.length=0;this.bufferLength_=0;}else{this.buffer_="";}};soy.StringBuilder.prototype.toString=function(){if(soy.IS_IE_){var a=this.buffer_.join("");this.clear();if(a){this.append(a);}return a;}else{return(this.buffer_);}};soy.renderElement=function(a,c,b){a.innerHTML=c(b);};soy.renderAsFragment=function(d,b){var c=document.createElement("div");c.innerHTML=d(b);if(c.childNodes.length==1){return c.firstChild;}else{var a=document.createDocumentFragment();while(c.firstChild){a.appendChild(c.firstChild);}return a;}};soy.$$augmentData=function(d,a){function e(){}e.prototype=d;var c=new e();for(var b in a){c[b]=a[b];}return c;};soy.$$escapeHtml=function(a){a=String(a);if(!soy.$$EscapeHtmlRe_.ALL_SPECIAL_CHARS.test(a)){return a;}if(a.indexOf("&")!=-1){a=a.replace(soy.$$EscapeHtmlRe_.AMP,"&amp;");}if(a.indexOf("<")!=-1){a=a.replace(soy.$$EscapeHtmlRe_.LT,"&lt;");}if(a.indexOf(">")!=-1){a=a.replace(soy.$$EscapeHtmlRe_.GT,"&gt;");}if(a.indexOf('"')!=-1){a=a.replace(soy.$$EscapeHtmlRe_.QUOT,"&quot;");}return a;};soy.$$EscapeHtmlRe_={ALL_SPECIAL_CHARS:/[&<>\"]/,AMP:/&/g,LT:/</g,GT:/>/g,QUOT:/\"/g};soy.$$escapeJs=function(b){b=String(b);var c=[];for(var a=0;a<b.length;a++){c[a]=soy.$$escapeChar(b.charAt(a));}return c.join("");};soy.$$escapeChar=function(a){if(a in soy.$$escapeCharJs_){return soy.$$escapeCharJs_[a];}var d=a;var b=a.charCodeAt(0);if(b>31&&b<127){d=a;}else{if(b<256){d="\\x";if(b<16||b>256){d+="0";}}else{d="\\u";if(b<4096){d+="0";}}d+=b.toString(16).toUpperCase();}return soy.$$escapeCharJs_[a]=d;};soy.$$escapeCharJs_={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"'":"\\'","\\":"\\\\"};soy.$$escapeUri=function(a){a=String(a);if(!soy.$$ENCODE_URI_REGEXP_.test(a)){return encodeURIComponent(a);}else{return a;}};soy.$$ENCODE_URI_REGEXP_=/^[a-zA-Z0-9\-_.!~*'()]*$/;soy.$$insertWordBreaks=function(l,f){l=String(l);var j=[];var k=0;var d=false;var e=false;var h=0;var b=0;for(var c=0,g=l.length;c<g;++c){var a=l.charCodeAt(c);if(h>=f&&a!=soy.$$CharCode_.SPACE){j[k++]=l.substring(b,c);b=c;j[k++]=soy.WORD_BREAK_;h=0;}if(d){if(a==soy.$$CharCode_.GREATER_THAN){d=false;}}else{if(e){switch(a){case soy.$$CharCode_.SEMI_COLON:e=false;++h;break;case soy.$$CharCode_.LESS_THAN:e=false;d=true;break;case soy.$$CharCode_.SPACE:e=false;h=0;break;}}else{switch(a){case soy.$$CharCode_.LESS_THAN:d=true;break;case soy.$$CharCode_.AMPERSAND:e=true;break;case soy.$$CharCode_.SPACE:h=0;break;default:++h;break;}}}}j[k++]=l.substring(b);return j.join("");};soy.$$CharCode_={SPACE:32,AMPERSAND:38,SEMI_COLON:59,LESS_THAN:60,GREATER_THAN:62};soy.WORD_BREAK_=soy.IS_WEBKIT_?"<wbr></wbr>":soy.IS_OPERA_?"&shy;":"<wbr>";soy.$$changeNewlineToBr=function(a){a=String(a);if(!soy.$$CHANGE_NEWLINE_TO_BR_RE_.test(a)){return a;}return a.replace(/(\r\n|\r|\n)/g,"<br>");};soy.$$CHANGE_NEWLINE_TO_BR_RE_=/[\r\n]/;soy.$$bidiTextDir=function(b,a){b=soy.$$bidiStripHtmlIfNecessary_(b,a);if(!b){return 0;}return soy.$$bidiDetectRtlDirectionality_(b)?-1:1;};soy.$$bidiDirAttr=function(a,d,c){var b=soy.$$bidiTextDir(d,c);if(b!=a){return b<0?"dir=rtl":b>0?"dir=ltr":"";}return"";};soy.$$bidiMarkAfter=function(a,d,c){var b=soy.$$bidiTextDir(d,c);return soy.$$bidiMarkAfterKnownDir(a,b,d,c);};soy.$$bidiMarkAfterKnownDir=function(a,b,d,c){return(a>0&&(b<0||soy.$$bidiIsRtlExitText_(d,c))?"\u200E":a<0&&(b>0||soy.$$bidiIsLtrExitText_(d,c))?"\u200F":"");};soy.$$bidiStripHtmlIfNecessary_=function(b,a){return a?b.replace(soy.$$BIDI_HTML_SKIP_RE_," "):b;};soy.$$BIDI_HTML_SKIP_RE_=/<[^>]*>|&[^;]+;/g;soy.$$bidiSpanWrap=function(a,c){c=String(c);var d=soy.$$bidiTextDir(c,true);var b=soy.$$bidiMarkAfterKnownDir(a,d,c,true);if(d>0&&a<=0){c="<span dir=ltr>"+c+"</span>";}else{if(d<0&&a>=0){c="<span dir=rtl>"+c+"</span>";}}return c+b;};soy.$$bidiUnicodeWrap=function(a,c){c=String(c);var d=soy.$$bidiTextDir(c,true);var b=soy.$$bidiMarkAfterKnownDir(a,d,c,true);if(d>0&&a<=0){c="\u202A"+c+"\u202C";}else{if(d<0&&a>=0){c="\u202B"+c+"\u202C";}}return c+b;};soy.$$bidiLtrChars_="A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02B8\u0300-\u0590\u0800-\u1FFF\u2C00-\uFB1C\uFDFE-\uFE6F\uFEFD-\uFFFF";soy.$$bidiNeutralChars_="\u0000-\u0020!-@[-`{-\u00BF\u00D7\u00F7\u02B9-\u02FF\u2000-\u2BFF";soy.$$bidiRtlChars_="\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC";soy.$$bidiRtlDirCheckRe_=new RegExp("^[^"+soy.$$bidiLtrChars_+"]*["+soy.$$bidiRtlChars_+"]");soy.$$bidiNeutralDirCheckRe_=new RegExp("^["+soy.$$bidiNeutralChars_+"]*$|^http://");soy.$$bidiIsRtlText_=function(a){return soy.$$bidiRtlDirCheckRe_.test(a);};soy.$$bidiIsNeutralText_=function(a){return soy.$$bidiNeutralDirCheckRe_.test(a);};soy.$$bidiRtlDetectionThreshold_=0.4;soy.$$bidiRtlWordRatio_=function(c){var b=0;var e=0;var d=c.split(" ");for(var a=0;a<d.length;a++){if(soy.$$bidiIsRtlText_(d[a])){b++;e++;}else{if(!soy.$$bidiIsNeutralText_(d[a])){e++;}}}return e==0?0:b/e;};soy.$$bidiDetectRtlDirectionality_=function(a){return soy.$$bidiRtlWordRatio_(a)>soy.$$bidiRtlDetectionThreshold_;};soy.$$bidiLtrExitDirCheckRe_=new RegExp("["+soy.$$bidiLtrChars_+"][^"+soy.$$bidiRtlChars_+"]*$");soy.$$bidiRtlExitDirCheckRe_=new RegExp("["+soy.$$bidiRtlChars_+"][^"+soy.$$bidiLtrChars_+"]*$");soy.$$bidiIsLtrExitText_=function(b,a){b=soy.$$bidiStripHtmlIfNecessary_(b,a);return soy.$$bidiLtrExitDirCheckRe_.test(b);};soy.$$bidiIsRtlExitText_=function(b,a){b=soy.$$bidiStripHtmlIfNecessary_(b,a);return soy.$$bidiRtlExitDirCheckRe_.test(b);};(function(a){a.fn.categorylist=function(){var c=this;return{initialize:function(f){return c.each(function(){var g=a(this);b(g);});},updateChecked:function(){return c.each(function(){var f=a(this);e(f);});}};function b(f){function g(i){var l=i.attr("name");if(i.hasClass("picplan")){return;}if(i.hasClass("any")){if(i[0].checked){i.parent().siblings().find("input").attr("checked",false);}return;}else{a("#navigator-cat-any").removeAttr("checked");}var j=a("#group-"+l);if(i.hasClass("cat-parent")){i.parent().find("ol input").attr("checked",i.attr("checked"));}else{d(j);}var h=j.find("input:not(.cat-parent, .any)");var k=h.filter("input:checked");if(k.length==0){a("#navigator-cat-any").attr("checked",true);return;}}f.delegate("input","click",function(){g(a(this));a('input[name="cat"]').each(function(){if(this.checked){a('label[for="'+this.id+'"]').addClass("checkbox_checked");}else{a('label[for="'+this.id+'"]').removeClass("checkbox_checked");}});});}function d(f){var g=f.find("ol.sub-facets");a.each(g,function(){var h=a(this);var i=h.siblings("input");var j=h.find("input:checked").length;if(j){i.attr("checked",true);}else{i.removeAttr("checked");}});}function e(g){var f=g.find("input:not(.picplan, .any)");if(f.filter("input:checked").length){d(g);}else{g.find("input.any").attr("checked",true);a('label[for="navigator-cat-any"]').addClass("checkbox_checked");}}};})(window.jQuery);if(typeof CI=="undefined"){var CI={};}if(typeof CI.UI=="undefined"){CI.UI={};}if(typeof CI.UI.Flyout=="undefined"){CI.UI.Flyout={};}if(typeof CI.UI.Flyout.Templates=="undefined"){CI.UI.Flyout.Templates={};}CI.UI.Flyout.Templates.categoryPanel=function(a,b){var c=b||new soy.StringBuilder();c.append('<div id="category-container"><ol><li id="group-cat" class="so_checkboxes"><ol><li class="any">');CI.UI.Flyout.Templates.checkbox({Value:"any",Class:"any",Title:a.Labels.AnyCategory,Name:a.Labels.AnyCategory},c);c.append("</li><li>");CI.UI.Flyout.Templates.checkbox({Value:"1",Class:"cat-parent",Title:a.Hover.Creative,Name:a.Labels.Creative},c);c.append('<ol id="group-cat-1" class="sub-facets"><li>');CI.UI.Flyout.Templates.checkbox({Value:"21",Class:"",Title:a.Hover.RightsManaged,Name:a.Labels.RightsManaged},c);c.append("</li><li>");CI.UI.Flyout.Templates.checkbox({Value:"20",Class:"",Title:a.Hover.RoyaltyFree,Name:a.Labels.RoyaltyFree},c);c.append("</li></ol></li><li>");CI.UI.Flyout.Templates.checkbox({Value:"2",Class:"cat-parent",Title:a.Hover.Editorial,Name:a.Labels.Editorial},c);c.append('<ol id="group-cat-2" class="sub-facets"><li>');CI.UI.Flyout.Templates.checkbox({Value:"14",Class:"",Title:a.Hover.Documentary,Name:a.Labels.Documentary},c);c.append("</li><li>");CI.UI.Flyout.Templates.checkbox({Value:"23",Class:"",Title:a.Hover.News,Name:a.Labels.News},c);c.append("</li><li>");CI.UI.Flyout.Templates.checkbox({Value:"24",Class:"",Title:a.Hover.Sports,Name:a.Labels.Sports},c);c.append("</li><li>");CI.UI.Flyout.Templates.checkbox({Value:"19",Class:"",Title:a.Hover.Entertainment,Name:a.Labels.Entertainment},c);c.append("</li><li>");CI.UI.Flyout.Templates.checkbox({Value:"22",Class:"",Title:a.Hover.Historical,Name:a.Labels.Historical},c);c.append("</li><li>");CI.UI.Flyout.Templates.checkbox({Value:"17",Class:"",Title:a.Hover.FineArt,Name:a.Labels.FineArt},c);c.append("</li>");if(a.ShowOutline){c.append("<li>");CI.UI.Flyout.Templates.checkbox({Value:"18",Class:"",Title:a.Hover.Outline,Name:a.Labels.Outline},c);c.append("</li>");}c.append("</ol></li></ol></li></ol>",(a.ShowAdvancedSearch)?'<div id="advanced-panel" class="top-level">'+a.AdvancedSearchPrefix+'<br/><div><a id="advanced_search2">'+a.ShowAdvancedSearch+"</a></div></div>":"","</div>");if(!b){return c.toString();}};CI.UI.Flyout.Templates.checkbox=function(a,b){var c=b||new soy.StringBuilder();c.append('<input type="checkbox"  name="cat" value="',soy.$$escapeHtml(a.Value),'" id="navigator-cat-',soy.$$escapeHtml(a.Value),'" class="',soy.$$escapeHtml(a.Class),'" /><label for="navigator-cat-',soy.$$escapeHtml(a.Value),'"><span class="facet-description" title="',soy.$$escapeHtml(a.Title),'" id="facet-cat-',soy.$$escapeHtml(a.Value),'-description">',soy.$$escapeHtml(a.Name),"</span></label>");if(!b){return c.toString();}};(function(a){(function(){var e="input[value!=1][value!=2][value!=any]";var f="cat";var o="searchOptions";var k=false;var b;function n(){var v={Labels:CI.UI.Flyout.Categories,Hover:CI.UI.Flyout.Categories.Hover,ShowOutline:CorbisData.AllowOutlineSearch,ShowAdvancedSearch:CI.UI.Flyout.Categories.ShowAdvancedSearch,AdvancedSearchPrefix:CI.UI.Flyout.Categories.AdvancedSearchPrefix};var u=soy.renderAsFragment(CI.UI.Flyout.Templates.categoryPanel,v);return a(u);}function d(u){var v=(CorbisUI.MoreSearchOptions&&CorbisUI.Search);if(v){u.find(e).searchOptions(f);}u.find("input").click(l);}function l(){var w=(CorbisData.Locale=="en-US");var u=(this.checked)?"Add":"Remove";var v="cat";v+="_"+this.value;if(w){v+=":"+a(this).siblings("label").text();}CorbisUI.Omniture.logPageLink("Search Flyout","Filter_"+u,{eVar43:v});}function t(w,x){if(k){return;}var u=a(w.target);var v=u.categorylist().initialize({updateHash:null});p(v);v.categorylist().updateChecked();d(v);k=true;}function p(u){var w=i();if(f in w){var x=w[f];if(typeof x=="string"){x=x.split(",");}for(var v=0;v<x.length;v++){h(u,x[v]).attr("checked",true);}}}function j(){var u=a("#category-container").find(e).filter("input:checked");var v={};categories=[];u.each(function(){categories.push(this.value);});if(categories.length){v[f]=categories.join(",");}return v;}function s(u){var v=j();q(u,v);}function h(u,v){return u.find("#navigator-"+f+"-"+v);}function q(u,y){function w(C){var z=h(u,C);var A=z.next().children("span").text();if(z.hasClass("cat-parent")){return A;}var B=z.closest("ol").siblings("label").children("span").text();if(A.indexOf(")")>-1){return B+A.substring(A.indexOf("(")-1);}else{return A+B.substring(B.indexOf("(")-1);}}function x(){function z(I){var G=h(u,I);var F=G.siblings("ol").find(e);var H=F.length;if(H!=E.length){return false;}while(H--){if(a.inArray(F[H].value,E)==-1){return false;}}return true;}function A(){var F=u.find(e).length;return(F==E.length);}function C(){var G=E.length;var H=[];for(var F=0;F<G;F++){H.push(w(E[F]));}return H.join(", ");}var B={text:CI.UI.Flyout.Categories.AnyCategory,hover:CI.UI.Flyout.Categories.AnyCategory};if(y&&f in y){var E=y[f];if(typeof E=="string"){E=E.split(",");}switch(E.length){case 0:return B;case 1:B.text=B.hover=w(E[0]);return B;default:if(A()){return B;}for(var D=1;D<=2;D++){if(z(D)){B.text=B.hover=w(D);return B;}}B.text=CI.UI.Flyout.Categories.CategoryCount.replace("{0}",E.length);B.hover=C();return B;}}return B;}var v=x();b.find("#flyout-info").attr("title",v.hover).html(v.text);b.show();}function r(){var v=i();var u=j();if(!u[f]){delete v[f];}a.extend(v,u);CI.UI.Cookie.storeCookie(o,v,{path:"/"});}function i(){var u;if(window.location.hash){u=CorbisUI.Hash.getHash();}else{var v=CI.UI.Cookie.getCookie(o);if(v){u=CI.UI.Cookie.parseCookie(v);}}return u||{};}function g(u,v){s(a(u.target));r();a(document).unbind("click.flyout");b.unbind("click.flyout");a("#advanced_search2").unbind("click.flyout");a("#advanced_search").unbind("click.flyout");return false;}function m(){c();}function c(){a(document).bind("click.flyout",function(v){var u=a(v.target).parents();if(u.filter("#"+b[0].id).length){return false;}if(!u.filter(".ui-dialog").length){a("#category-container").dialog("close");}});b.one("click.flyout",function(u){a("#category-container").dialog("close");});a("#advanced_search").bind("click.flyout",function(){a("#category-container").dialog("close");});a("#advanced_search2").bind("click.flyout",function(u){a("#advanced_search").data("alreadyLogged",true).trigger("click",u);a("#category-container").dialog("close");CorbisUI.Omniture.logPageLink("Search Flyout","Advanced Search");if(CorbisUI.ExtendedSearch!=undefined){CorbisUI.ExtendedSearch.vars.omnitureTriggered=true;CorbisUI.ExtendedSearch.OpenMoreSearchOptions();}return false;});}this.attachCategories=function(u,w){b=u;var v=n();var y=i();q(v,y);var x={create:t,close:g,open:m,width:185,position:{my:"right top",at:"right bottom",of:w,offset:"-10 0"},zIndex:1,modal:false};CI.UI.Dialogs.Menu(b,v,x);};}).apply(CI.UI.Flyout);})(window.jQuery);(function(a){var c={searchButton:a("#search_go-button,div.Go"),flyout:a("#flyout-info-container")};var b=CorbisUI.Routes||CorbisRoutes;if(b.Search==CorbisData.Path){c.flyout.hide();}else{CI.UI.Flyout.attachCategories(c.flyout,c.searchButton);}})(window.jQuery);if(typeof CI=="undefined"){var CI={};}if(typeof CI.UI=="undefined"){CI.UI={};}if(typeof CI.UI.VisualSearch=="undefined"){CI.UI.VisualSearch={};}if(typeof CI.UI.VisualSearch.Templates=="undefined"){CI.UI.VisualSearch.Templates={};}CI.UI.VisualSearch.Templates.addImagePanel=function(a,b){var c=b||new soy.StringBuilder();c.append('<div id="visual-search-container"><div id="image-holder">X</div><div id="image-info"><ol><li><div id="upload-button"></div>',soy.$$escapeHtml(a.Labels.ChooseFile)," ",soy.$$escapeHtml(a.Labels.NoFile),"</li><li>",soy.$$escapeHtml(a.Labels.KeywordInfo),"</li></ol></div></div>");if(!b){return c.toString();}};var qq=qq||{};qq.extend=function(a,c){for(var b in c){a[b]=c[b];}};qq.indexOf=function(a,b,c){if(a.indexOf){return a.indexOf(b,c);}c=c||0;var d=a.length;if(c<0){c+=d;}for(;c<d;c++){if(c in a&&a[c]===b){return c;}}return -1;};qq.getUniqueId=(function(){var a=0;return function(){return a++;};})();qq.attach=function(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false);}else{if(a.attachEvent){a.attachEvent("on"+c,b);}}};qq.detach=function(a,c,b){if(a.removeEventListener){a.removeEventListener(c,b,false);}else{if(a.attachEvent){a.detachEvent("on"+c,b);}}};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault();}else{a.returnValue=false;}};qq.insertBefore=function(c,d){d.parentNode.insertBefore(c,d);};qq.remove=function(a){a.parentNode.removeChild(a);};qq.contains=function(b,a){if(b==a){return true;}if(b.contains){return b.contains(a);}else{return !!(a.compareDocumentPosition(b)&8);}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b;};})();qq.css=function(a,b){if(b.opacity!=null){if(typeof a.style.opacity!="string"&&typeof(a.filters)!="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")";}}qq.extend(a.style,b);};qq.hasClass=function(a,b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className);};qq.addClass=function(a,b){if(!qq.hasClass(a,b)){a.className+=" "+b;}};qq.removeClass=function(a,b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"");};qq.setText=function(a,b){a.innerText=b;a.textContent=b;};qq.children=function(c){var b=[],a=c.firstChild;while(a){if(a.nodeType==1){b.push(a);}a=a.nextSibling;}return b;};qq.getByClass=function(c,b){if(c.querySelectorAll){return c.querySelectorAll("."+b);}var f=[];var a=c.getElementsByTagName("*");var e=a.length;for(var d=0;d<e;d++){if(qq.hasClass(a[d],b)){f.push(a[d]);}}return f;};qq.obj2url=function(d,g,f){var h=[],e="&",a=function(k,j){var l=g?(/\[\]$/.test(g))?g:g+"["+j+"]":j;if((l!="undefined")&&(j!="undefined")){h.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k));}};if(!f&&g){e=(/\?/.test(g))?(/\?$/.test(g))?"":"&":"?";h.push(g);h.push(qq.obj2url(d));}else{if((Object.prototype.toString.call(d)==="[object Array]")&&(typeof d!="undefined")){for(var b=0,c=d.length;b<c;++b){a(d[b],b);}}else{if((typeof d!="undefined")&&(d!==null)&&(typeof d==="object")){for(var b in d){a(d[b],b);}}else{h.push(encodeURIComponent(g)+"="+encodeURIComponent(d));}}}return h.join(e).replace(/^&/,"").replace(/%20/g,"+");};var qq=qq||{};qq.FileUploaderBasic=function(a){this._options={debug:false,action:"/server/upload",params:{},button:null,multiple:true,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(c,b){},onProgress:function(c,b,d,e){},onComplete:function(c,b,d){},onCancel:function(c,b){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(b){alert(b);}};qq.extend(this._options,a);this._filesInProgress=0;this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button);}this._preventLeaveInProgress();};qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a;},getInProgress:function(){return this._filesInProgress;},_createUploadButton:function(a){var b=this;return new qq.UploadButton({element:a,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(c){b._onInputChange(c);}});},_createUploadHandler:function(){var c=this,b;if(qq.UploadHandlerXhr.isSupported()){b="UploadHandlerXhr";}else{b="UploadHandlerForm";}var a=new qq[b]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(e,d,f,g){c._onProgress(e,d,f,g);c._options.onProgress(e,d,f,g);},onComplete:function(e,d,f){c._onComplete(e,d,f);c._options.onComplete(e,d,f);},onCancel:function(e,d){c._onCancel(e,d);c._options.onCancel(e,d);}});return a;},_preventLeaveInProgress:function(){var a=this;qq.attach(window,"beforeunload",function(b){if(!a._filesInProgress){return;}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave;});},_onSubmit:function(b,a){this._filesInProgress++;},_onProgress:function(b,a,c,d){},_onComplete:function(b,a,c){this._filesInProgress--;if(c.error){this._options.showMessage(c.error);}},_onCancel:function(b,a){this._filesInProgress--;},_onInputChange:function(a){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files);}else{if(this._validateFile(a)){this._uploadFile(a);}}this._button.reset();},_uploadFileList:function(a){for(var b=0;b<a.length;b++){if(!this._validateFile(a[b])){return;}}for(var b=0;b<a.length;b++){this._uploadFile(a[b]);}},_uploadFile:function(a){var c=this._handler.add(a);var b=this._handler.getName(c);if(this._options.onSubmit(c,b)!==false){this._onSubmit(c,b);this._handler.upload(c,this._options.params);}},_validateFile:function(a){var b,c;if(a.value){b=a.value.replace(/.*(\/|\\)/,"");}else{b=a.fileName!=null?a.fileName:a.name;c=a.fileSize!=null?a.fileSize:a.size;}if(!this._isAllowedExtension(b)){this._error("typeError",b);return false;}else{if(c===0){this._error("emptyError",b);return false;}else{if(c&&this._options.sizeLimit&&c>this._options.sizeLimit){this._error("sizeError",b);return false;}else{if(c&&c<this._options.minSizeLimit){this._error("minSizeError",b);return false;}}}}return true;},_error:function(a,b){var c=this._options.messages[a];function d(e,f){c=c.replace(e,f);}d("{file}",this._formatFileName(b));d("{extensions}",this._options.allowedExtensions.join(", "));d("{sizeLimit}",this._formatSize(this._options.sizeLimit));d("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));this._options.showMessage(c);},_formatFileName:function(a){if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13);}return a;},_isAllowedExtension:function(c){var b=(-1!==c.indexOf("."))?c.replace(/.*[.]/,"").toLowerCase():"";var a=this._options.allowedExtensions;if(!a.length){return true;}for(var d=0;d<a.length;d++){if(a[d].toLowerCase()==b){return true;}}return false;},_formatSize:function(a){var b=-1;do{a=a/1024;b++;}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b];}};qq.FileUploader=function(a){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Upload a file</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}});qq.extend(this._options,a);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._button=this._createUploadButton(this._find(this._element,"button"));this._bindCancelEvent();this._setupDragDrop();};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(b,c){var a=qq.getByClass(b,this._options.classes[c])[0];if(!a){throw new Error("element not found "+c);}return a;},_setupDragDrop:function(){var c=this,a=this._find(this._element,"drop");var b=new qq.UploadDropZone({element:a,onEnter:function(d){qq.addClass(a,c._classes.dropActive);d.stopPropagation();},onLeave:function(d){d.stopPropagation();},onLeaveNotDescendants:function(d){qq.removeClass(a,c._classes.dropActive);},onDrop:function(d){a.style.display="none";qq.removeClass(a,c._classes.dropActive);c._uploadFileList(d.dataTransfer.files);}});a.style.display="none";qq.attach(document,"dragenter",function(d){if(!b._isValidFileDrag(d)){return;}a.style.display="block";});qq.attach(document,"dragleave",function(d){if(!b._isValidFileDrag(d)){return;}var f=document.elementFromPoint(d.clientX,d.clientY);if(!f||f.nodeName=="HTML"){a.style.display="none";}});},_onSubmit:function(b,a){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a);},_onProgress:function(b,a,d,g){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var c=this._getItemByFileId(b);var e=this._find(c,"size");e.style.display="inline";var f;if(d!=g){f=Math.round(d/g*100)+"% from "+this._formatSize(g);}else{f=this._formatSize(g);}qq.setText(e,f);},_onComplete:function(b,a,d){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var c=this._getItemByFileId(b);qq.remove(this._find(c,"cancel"));qq.remove(this._find(c,"spinner"));if(d.success){qq.addClass(c,this._classes.success);}else{qq.addClass(c,this._classes.fail);}},_addToList:function(c,b){var d=qq.toElement(this._options.fileTemplate);d.qqFileId=c;var a=this._find(d,"file");qq.setText(a,this._formatFileName(b));this._find(d,"size").style.display="none";this._listElement.appendChild(d);},_getItemByFileId:function(a){var b=this._listElement.firstChild;while(b){if(b.qqFileId==a){return b;}b=b.nextSibling;}},_bindCancelEvent:function(){var b=this,a=this._listElement;qq.attach(a,"click",function(c){c=c||window.event;var f=c.target||c.srcElement;if(qq.hasClass(f,b._classes.cancel)){qq.preventDefault(c);var d=f.parentNode;b._handler.cancel(d.qqFileId);qq.remove(d);}});}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);this._element=this._options.element;this._disableDropOutside();this._attachEvents();};qq.UploadDropZone.prototype={_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,"dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault();}});qq.UploadDropZone.dropOutsideDisabled=true;}},_attachEvents:function(){var a=this;qq.attach(a._element,"dragover",function(b){if(!a._isValidFileDrag(b)){return;}var c=b.dataTransfer.effectAllowed;if(c=="move"||c=="linkMove"){b.dataTransfer.dropEffect="move";}else{b.dataTransfer.dropEffect="copy";}b.stopPropagation();b.preventDefault();});qq.attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return;}a._options.onEnter(b);});qq.attach(a._element,"dragleave",function(b){if(!a._isValidFileDrag(b)){return;}a._options.onLeave(b);var c=document.elementFromPoint(b.clientX,b.clientY);if(qq.contains(this,c)){return;}a._options.onLeaveNotDescendants(b);});qq.attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return;}b.preventDefault();a._options.onDrop(b);});},_isValidFileDrag:function(b){var a=b.dataTransfer,c=navigator.userAgent.indexOf("AppleWebKit")>-1;return a&&a.effectAllowed!="none"&&(a.files||(!c&&a.types.contains&&a.types.contains("Files")));}};qq.UploadButton=function(a){this._options={element:null,multiple:false,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput();};qq.UploadButton.prototype={getInput:function(){return this._input;},reset:function(){if(this._input.parentNode){qq.remove(this._input);}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput();},_createInput:function(){var a=document.createElement("input");if(this._options.multiple){a.setAttribute("multiple","multiple");}a.setAttribute("type","file");a.setAttribute("name",this._options.name);qq.css(a,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});this._element.appendChild(a);var b=this;qq.attach(a,"change",function(){b._options.onChange(a);});qq.attach(a,"mouseover",function(){qq.addClass(b._element,b._options.hoverClass);});qq.attach(a,"mouseout",function(){qq.removeClass(b._element,b._options.hoverClass);});qq.attach(a,"focus",function(){qq.addClass(b._element,b._options.focusClass);});qq.attach(a,"blur",function(){qq.removeClass(b._element,b._options.focusClass);});if(window.attachEvent){a.setAttribute("tabIndex","-1");}return a;}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(c,b,d,e){},onComplete:function(c,b,d){},onCancel:function(c,b){}};qq.extend(this._options,a);this._queue=[];this._params=[];};qq.UploadHandlerAbstract.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a);}},add:function(a){},upload:function(b,d){var c=this._queue.push(b);var a={};qq.extend(a,d);this._params[b]=a;if(c<=this._options.maxConnections){this._upload(b,this._params[b]);}},cancel:function(a){this._cancel(a);this._dequeue(a);},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a]);}this._queue=[];},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue;},_upload:function(a){},_cancel:function(a){},_dequeue:function(b){var a=qq.indexOf(this._queue,b);this._queue.splice(a,1);var c=this._options.maxConnections;if(this._queue.length>=c&&a<c){var d=this._queue[c-1];this._upload(d,this._params[d]);}}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={};};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name","qqfile");var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq.remove(a);}return b;},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"");},_cancel:function(a){this._options.onCancel(a,this.getName(a));delete this._inputs[a];var b=document.getElementById(a);if(b){b.setAttribute("src","javascript:false;");qq.remove(b);}},_upload:function(c,f){var e=this._inputs[c];if(!e){throw new Error("file with passed id was not added, or already uploaded or cancelled");}var a=this.getName(c);var d=this._createIframe(c);var b=this._createForm(d,f);b.appendChild(e);var g=this;this._attachLoadEvent(d,function(){g.log("iframe loaded");var h=g._getIframeContentJSON(d);g._options.onComplete(c,a,h);g._dequeue(c);delete g._inputs[c];setTimeout(function(){qq.remove(d);},1);});b.submit();qq.remove(b);return c;},_attachLoadEvent:function(b,a){qq.attach(b,"load",function(){if(!b.parentNode){return;}if(b.contentDocument&&b.contentDocument.body&&b.contentDocument.body.innerHTML=="false"){return;}a();});},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")");}catch(err){response={};}return response;},_createIframe:function(a){var b=qq.toElement('<iframe src="javascript:false;" name="'+a+'" />');b.setAttribute("id",a);b.style.display="none";document.body.appendChild(b);return b;},_createForm:function(b,c){var a=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');var d=qq.obj2url(c,this._options.action);a.setAttribute("action",d);a.setAttribute("target",b.name);a.style.display="none";document.body.appendChild(a);return a;}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[];};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return("multiple" in a&&typeof File!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined");};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)");}return this._files.push(a)-1;},getName:function(b){var a=this._files[b];return a.fileName!=null?a.fileName:a.name;},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size;},getLoaded:function(a){return this._loaded[a]||0;},_upload:function(b,d){var a=this._files[b],c=this.getName(b),g=this.getSize(b);this._loaded[b]=0;var h=this._xhrs[b]=new XMLHttpRequest();var f=this;h.upload.onprogress=function(i){if(i.lengthComputable){f._loaded[b]=i.loaded;f._options.onProgress(b,c,i.loaded,i.total);}};h.onreadystatechange=function(){if(h.readyState==4){f._onComplete(b,h);}};d=d||{};d.qqfile=c;var e=qq.obj2url(d,this._options.action);h.open("POST",e,true);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.setRequestHeader("X-File-Name",encodeURIComponent(c));h.setRequestHeader("Content-Type","application/octet-stream");h.send(a);},_onComplete:function(id,xhr){if(!this._files[id]){return;}var name=this.getName(id);var size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")");}catch(err){response={};}this._options.onComplete(id,name,response);}else{this._options.onComplete(id,name,{});}this._files[id]=null;this._xhrs[id]=null;this._dequeue(id);},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null;}}});(function(a){function c(){var e={Labels:CI.UI.Header.VisualSearch};var f=soy.renderAsFragment(CI.UI.VisualSearch.Templates.addImagePanel,e);return a(f);}function d(){var e=document.getElementById("upload-button");var f=new qq.FileUploader({element:e,allowedExtensions:["jpg","jpeg","png","gif"],sizeLimit:2147483647,action:"/Ajax/Search/Upload",multiple:false});}function b(){var f=a("#image-uploader");var g={title:CI.UI.Header.VisualSearch.Title,open:d,width:465,height:241,position:{my:"right top",at:"right bottom",of:f,offset:"-10 50"}};var e=c();CI.UI.Dialogs.Modal(f,e,g);}b();})(window.jQuery);(function(a){var d=["#FirstName","#searchbar",".keywordSearch.ui-autocomplete-input"];for(var c=0;c<d.length;c++){var b=a(d[c]);if(b){b.focus();return;}}})(window.jQuery);

/************************************************************/
/* Embedded CSS Content                                     */
/************************************************************/
CorbisUtilities.StaticResourceManager.AddCSS(".checkbox_checked{color:#FFF}.so_checkboxes{color:#CCC}#category-container{border-radius:3px;width:185px;min-width:185px;background:#CCC;background-color:#333;font-size:11px;color:#DEDEDE;padding:5px;-moz-box-shadow:0 0 5px #000;-webkit-box-shadow:0 0 5px #000;box-shadow:0 0 5px #000;line-height:16px}#category-container ol{list-style-type:none}#category-container li li{padding-left:14px}#category-container label{vertical-align:middle;padding-left:3px;display:inline}#advanced_search:hover{border-bottom:0}#advanced_search2:hover{border-bottom:1px dotted #69C!important}#category-container #advanced-panel{border-top:1px dotted #444;text-align:left;margin-top:3px;padding-left:13px;padding-top:5px;color:#ccc}#flyout-info-break{border-left:1px solid #366A9A;line-height:21px;margin-top:5px}#flyout-info{color:#366A9A;position:relative;margin-left:-5px;text-align:right;font-size:11px;padding-left:5px}#flyout-info-container img.search-header-menu-arrow{position:absolute;top:13px;padding:0 0 3px 4px;right:5px}#Search #flyout-info-container{margin-top:10px}#flyout-info-container{line-height:25px;height:25px;padding:0 15px;cursor:pointer;float:left;background-color:white;min-width:120px;position:relative;text-align:right}#category-container li.last-element{padding-left:10px}#visual-search-container{background-color:#E8E8E8;color:#666}#visual-search-container div.ui-dialog-titlebar{background-color:#DBDBDB;font-size:14px}.qq-uploader{position:relative;width:100%}.qq-upload-button{display:block;width:105px;padding:7px 0;text-align:center;background:#800;border-bottom:1px solid #ddd;color:#fff}.qq-upload-button-hover{background:#c00}.qq-upload-button-focus{outline:1px dotted black}.qq-upload-drop-area{position:absolute;top:0;left:0;width:100%;height:100%;min-height:70px;z-index:2;background:#FF9797;text-align:center}.qq-upload-drop-area span{display:block;position:absolute;top:50%;width:100%;margin-top:-8px;font-size:16px}.qq-upload-drop-area-active{background:#FF7171}.qq-upload-list{margin:15px 35px;padding:0;list-style:disc}.qq-upload-list li{margin:0;padding:0;line-height:15px;font-size:12px}.qq-upload-file,.qq-upload-spinner,.qq-upload-size,.qq-upload-cancel,.qq-upload-failed-text{margin-right:7px}.qq-upload-spinner{display:inline-block;background:url(/images/loading.gif);width:15px;height:15px;vertical-align:text-bottom}.qq-upload-size,.qq-upload-cancel{font-size:11px}.qq-upload-failed-text{display:none}.qq-upload-fail .qq-upload-failed-text{display:inline}");

